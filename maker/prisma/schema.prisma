generator client {
  provider = "prisma-client"
  output   = "../server/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model Zone {
  id                   String  @id
  name                 String
  description          String
  safe                 Boolean @default(true)
  bgm                  String  @default("")
  bgmPrompt            String  @default("")
  bgmDuration          Int     @default(120)
  spawnRoom            String?
  spawnMaxEntities     Int     @default(0)
  spawnMaxPerRoom      Int     @default(0)
  spawnRateTicks       Int     @default(0)
  imageStyle           String  @default("")
  imageNegativePrompt  String  @default("")
  rooms                Room[]
  npcs                 Npc[]
}

model Room {
  id                  String @id
  zoneId              String
  zone                Zone   @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  name                String
  description         String
  x                   Int
  y                   Int
  backgroundImage     String @default("")
  effects             String @default("[]")
  bgm                 String @default("")
  bgmPrompt           String @default("")
  bgmDuration         Int    @default(0)
  departSound         String @default("")
  lockedExits         String @default("{}")
  lockResetTicks      String @default("{}")
  hiddenExits         String @default("{}")
  imagePrompt         String @default("")
  imageStyle          String @default("")
  imageNegativePrompt String @default("")
  interactables       String @default("[]")
  unpickableExits     String @default("[]")
  imageWidth          Int    @default(1024)
  imageHeight         Int    @default(576)
  exits               Exit[] @relation("fromRoom")
  incomingExits       Exit[] @relation("toRoom")
}

model Exit {
  id         Int    @id @default(autoincrement())
  fromRoomId String
  fromRoom   Room   @relation("fromRoom", fields: [fromRoomId], references: [id], onDelete: Cascade)
  direction  String
  toRoomId   String
  toRoom     Room   @relation("toRoom", fields: [toRoomId], references: [id], onDelete: Cascade)

  @@unique([fromRoomId, direction])
}

model Item {
  id               String  @id
  name             String
  description      String
  type             String
  slot             String  @default("")
  damageBonus      Int     @default(0)
  damageRange      Int     @default(0)
  armorValue       Int     @default(0)
  value            Int     @default(0)
  weight           Int     @default(0)
  stackable        Boolean @default(false)
  maxStack         Int     @default(1)
  useEffect        String  @default("")
  levelRequirement Int     @default(0)
  attackSound      String  @default("")
  missSound        String  @default("")
  useSound            String  @default("")
  imagePrompt         String  @default("")
  imageStyle          String  @default("")
  imageNegativePrompt String  @default("")
  imageWidth          Int     @default(256)
  imageHeight         Int     @default(256)
}

model Npc {
  id           String  @id
  zoneId       String
  zone         Zone    @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  name         String
  description  String
  startRoomId  String
  behaviorType String
  patrolRoute  String  @default("")
  hostile      Boolean @default(false)
  maxHp        Int     @default(0)
  damage       Int     @default(0)
  level        Int     @default(1)
  perception   Int     @default(0)
  xpReward     Int     @default(0)
  accuracy     Int     @default(0)
  defense      Int     @default(0)
  evasion      Int     @default(0)
  agility      Int     @default(10)
  vendorItems  String  @default("")
  spawnPoints  String  @default("[]")
  attackSound  String  @default("")
  missSound    String  @default("")
  deathSound   String  @default("")
  interactSound       String @default("")
  exitSound           String @default("")
  imagePrompt         String @default("")
  imageStyle          String @default("")
  imageNegativePrompt String @default("")
  imageWidth          Int    @default(384)
  imageHeight         Int    @default(512)
}

model CharacterClass {
  id            String @id
  name          String
  description   String
  minimumStats  String
  skills        String @default("[]")
  properties    String @default("{}")
  hpPerLevelMin Int    @default(4)
  hpPerLevelMax Int    @default(8)
  mpPerLevelMin Int    @default(0)
  mpPerLevelMax Int    @default(0)
  xpModifier    Float  @default(1.0)
  magicSchools        String @default("{}")
  imagePrompt         String @default("")
  imageStyle          String @default("")
  imageNegativePrompt String @default("")
  imageWidth          Int    @default(256)
  imageHeight         Int    @default(256)
}

model Race {
  id            String @id
  name          String
  description   String
  statModifiers String
  xpModifier          Float  @default(1.0)
  imagePrompt         String @default("")
  imageStyle          String @default("")
  imageNegativePrompt String @default("")
  imageWidth          Int    @default(256)
  imageHeight         Int    @default(256)
}

model Skill {
  id                String  @id
  name              String
  description       String
  category          String
  primaryStat       String
  secondaryStat     String
  cooldownTicks     Int     @default(0)
  manaCost          Int     @default(0)
  difficulty        Int     @default(15)
  isPassive         Boolean @default(false)
  classRestrictions String  @default("[]")
  properties          String  @default("{}")
  imagePrompt         String  @default("")
  imageStyle          String  @default("")
  imageNegativePrompt String  @default("")
  imageWidth          Int     @default(256)
  imageHeight         Int     @default(256)
}

model Spell {
  id             String @id
  name           String
  description    String
  school         String
  spellType      String
  manaCost       Int
  cooldownTicks  Int    @default(0)
  levelRequired  Int    @default(1)
  primaryStat    String @default("intellect")
  basePower      Int    @default(0)
  targetType     String @default("ENEMY")
  effectType     String @default("")
  effectDuration Int    @default(0)
  castMessage    String @default("")
  castSound      String @default("")
  impactSound    String @default("")
  missSound           String @default("")
  imagePrompt         String @default("")
  imageStyle          String @default("")
  imageNegativePrompt String @default("")
  imageWidth          Int    @default(256)
  imageHeight         Int    @default(256)
}

model LootTable {
  id       String @id
  items    String
  coinDrop String @default("")
}

model PcSprite {
  id                  String   @id
  race                String
  gender              String
  characterClass      String
  imagePrompt         String   @default("")
  imageStyle          String   @default("")
  imageNegativePrompt String   @default("")
  imageWidth          Int      @default(384)
  imageHeight         Int      @default(512)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@unique([race, gender, characterClass])
}

model DefaultSfx {
  id          String   @id
  label       String
  category    String   @default("")
  description String   @default("")
  prompt      String   @default("")
  duration    Int      @default(3)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ProjectMeta {
  key   String @id
  value String
}
